/**
 * Jquery Opie Tooltip
 * http://www.opiescripts.com/simple-jquery-tooltips
 * @param {Object} e
 * @author Gen Taliaru
 */
function debug(e){if(arguments.length>1){console.log(arguments)}else{console.log(e)}}jQuery.fn.setData=function(e,t){if(String(e)==="[object Object]"&&typeof t=="undefined"){for(var n in e){jQuery(this).data("opie-"+n,e[n])}return this}else{return jQuery(this).data("opie-"+e,t)}};jQuery.fn.call=function(e){return jQuery(this).trigger(e,Array.prototype.slice.call(arguments,1))};jQuery.fn.getData=function(e){return jQuery(this).data("opie-"+e)};jQuery.fn.setAttr=function(e,t){return jQuery(this).attr("data-opie-"+e,t)};jQuery.fn.getAttr=function(e){return jQuery(this).attr("data-opie-"+e)};jQuery.fn.delAttr=function(e){return jQuery(this).removeAttr("data-opie-"+e)};jQuery.fn.setEvent=function(e,t){return jQuery(this).bind("opie-"+e,t)};jQuery.fn.callEvent=function(e,t){return jQuery(this).trigger("opie-"+e,t)};var Is=new function(){this.defined=function(e){return typeof e!=="undefined"};this.number=function(e){return typeof e==="number"&&isFinite(e)};this.string=function(e){return typeof e==="string"};this.cssSelector=function(e){if(Is.string(e)){if(e=="#"){return false}if(e.substr(0,1)=="#"||e.substr(0,1)=="."||e.substr(0,1)==":"){return true}}return false}};var Opts=function(e,t){this.opts=e;this.jq=t};Opts.prototype={get:function(e){return this.parse(this.opts[e])},set:function(e,t){this.opts[e]=t;return this},string:function(e){return this.parse(this.opts[e],true)},number:function(e){return parseFloat(this.get(e))},bool:function(e){var t=this.get(e);if(t=="1"||t===true){return true}return false},selector:function(e){return this.jq(this.get(e))},func:function(e){return this.parse(this.opts[e],true,true)},parse:function(e,t,n){if(typeof e=="undefined"){return""}var r=e.valueOf();if(typeof r=="function"){if(n==true){return r}return r()}else if(this.isCssSelector(r)&&t!==true){var i=this.jq(r);if(i.size()<=0){debug("Opts.parse "+r+" not found");return false}var s=i.get(0).tagName=="INPUT"&&i.attr("type").toString().toLowerCase()=="checkbox";if(s){return i.is(":checked")}return i.val()}else{return r}},isCssSelector:function(e){if(typeof e==="string"){if(e=="#"){return false}if(e.substr(0,1)=="#"||e.substr(0,1)=="."||e.substr(0,1)==":"){return true}}return false}};(function(e){"use strict";var t=0;e.fn.OpieTooltip=function(t,n){var r={position:"bc:tc",event:"mouseover",eventout:"mouseout",fade:50,fadeout:200};if(t==="defaults"){return r}var i=new Opts(e.extend(r,t),e);var s;this.each(function(){s=new e.OpieTooltip(i,e(this),arguments);if(t==="initCSS3"){IS.initCSS3.apply(s,n)}else{s.init()}});return this};e.OpieTooltip=function(n,r,i){var s=this;this.init=function(){var t=s.getOpt(r,"event");var n=t?t:"mouseover";var i=s.draw(r);r.on(n,function(t){var n=e(this);var r=s.draw(n);if(t.type=="click"){r.find(".o-tooltip-close").show()}else{r.find(".o-tooltip-close").hide()}if(!n.getData("title")&&!n.attr("title")&&!s.getOpt(n,"template")&&!n.attr("alt")&&n.attr("href")=="#"){return}var i=s.getOpt(n,"fade");r.stop().fadeTo(i,1);if(!n.getData("title")){n.setData("title",n.attr("title")).attr("title","");n.setData("alt",n.attr("alt")).attr("alt","")}s.setContent(n,r);var o=s.getOpt(n,"position").split(":");var u=o[0];var a=o[1];s.updatePosition(r,n,u,a)});var o=i.find(".o-tooltip-close");if(n=="click"){var u="void";o.show()}else{var t=s.getOpt(r,"eventout");var u=t?t:"mouseout";o.hide()}if(u!="void"){r.on(u,function(t){if(t.type!="click"){i.find(".o-tooltip-close").hide()}s.close(e(this))})}};this.close=function(e){var t=s.draw(e);var n=s.getOpt(e,"fadeout");var r=n?parseFloat(n):null;t.stop().fadeTo(r,0,function(){t.remove()})};this.draw=function(n){var r=n.getData("opie-tool-tip-id");if(r){var i=e("#"+r);if(i.size()>0){return i}}if(n.getData("tooltip-id")){var o=n.getData("tooltip-id")}else{var o="opieTooltip-"+t;t++}var i=e('<div class="o-tooltip" id="'+o+'"><div class="o-tooltip-arrow"></div><div class="o-tooltip-close"><span>x</span></div><div class="o-tooltip-inner"></div></div>');i.find(".o-tooltip-close").on("click",function(){s.close(e(this).parents(".o-tooltip").getData("target"))});i.setData("target",n);n.setData("opie-tool-tip-id",o);i.setEvent("updatePosition",function(t,n,r,i,o){s.updatePosition(e(this),n,r,i,o)});e("body").append(i);i.hide();return i};this.getOpt=function(e,t,r){if(Is.defined(e.getAttr(t))){return e.getAttr(t)}return r?n.string(t):n.get(t)};this.setContent=function(t,n){var r=n.find(".o-tooltip-inner");var i=s.getOpt(t,"template",true);if(i){if(!n.getData("template")){if(!Is.cssSelector(i)){i="<div>"+i+"</div>"}var o=e(i);n.setData("template",o.html())}var u=n.getData("template");if(!Is.defined(n.getData("template"))){console.log("Template not found");return false}e.each(n.getData("template").match(/\{.*?\}/img),function(e,n){var r=n.replace("{","").replace("}","");var i=t.attr(r);if(r=="title"){i=t.getData("title")}u=u.replace(n,i)});n.find(".o-tooltip-inner").html(u)}else{n.find(".o-tooltip-inner").html(t.getData("title"))}};this.updatePosition=function(t,n,r,i,o){if(!n){n=t.getData("target");var u=s.getOpt(n,"position").split(":");var r=u[0];var i=u[1]}var a=n.offset().top;var f=n.offset().left;var l=n.outerHeight();var c=n.outerWidth();var h=t.offset().top;var p=t.offset().left;var d=t.outerHeight();var v=t.outerWidth();var m={top:0,left:0};t.attr("class","o-tooltip "+i);if(r.charAt(0)=="t"){m.top=a}else if(r.charAt(0)=="m"){m.top=a+l/2}else if(r.charAt(0)=="b"){m.top=a+l}if(r.charAt(1)=="l"){m.left=f}else if(r.charAt(1)=="c"){m.left=f+c/2}else if(r.charAt(1)=="r"){m.left=f+c}if(i.charAt(0)=="m"){m.top-=d/2}else if(i.charAt(0)=="b"){m.top-=d}if(i.charAt(1)=="r"){m.left-=v}else if(i.charAt(1)=="c"){m.left-=v/2}t.css(m);if(o!==true){var h=t.offset().top;var p=t.offset().left;var g=e(window).scrollTop();var y=e(window).scrollLeft();var b=h+t.outerHeight()-g;var w=p+t.outerWidth()-y;var E=e(window).height();var S=e(window).width();var x={b:"t",t:"b",l:"r",r:"l"};if(h<g){var T="b"}else if(b>E){var T="t"}if(h<g||b>E){var N=r;if(r.charAt(0)!=T){x.m="b";if(b>E){x.m="t"}var N=x[r.charAt(0)]+r.charAt(1)}var C=i;if(i!="ml"&&i!="mr"){var C=x[i.charAt(0)]+i.charAt(1)}r=N;i=C}if(p<0){var T="r"}else if(w>S){var T="l"}if(p<0||w>S){var N=r;if(r.charAt(0)!=T){x.m="r";if(w>S){x.m="l"}var N=r.charAt(0)+x[r.charAt(1)]}var C=i;if(i!="tc"&&i!="bc"){var C=i.charAt(0)+x[i.charAt(1)]}}if(h<g||b>E||p<0||w>S){s.updatePosition(t,n,N,C,true)}}}}})(jQuery)